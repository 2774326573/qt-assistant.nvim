# Qt Assistant - 第三方库集成使用指南

本文档介绍如何使用 Qt Assistant 插件来管理和集成第三方库到 Qt 项目中。

## 功能概述

Qt Assistant 现在支持：
1. **文档模板生成** - 自动生成项目文档、API文档、模块文档等
2. **第三方库管理** - 在相对目录中导入和管理第三方库
3. **自动CMake配置** - 自动生成第三方库的CMake配置

## 快速开始

### 1. 配置第三方库支持

在你的 Neovim 配置中启用第三方库管理：

```lua
require('qt-assistant').setup({
    third_party = {
        -- 启用第三方库管理
        enabled = true,
        
        -- 第三方库根目录（相对于项目根目录）
        root_dir = "third_party",
        
        -- 库配置示例
        libraries = {
            boost = {
                path = "third_party/boost",
                include_dir = "include",
                lib_dir = "lib",
                version = "1.80.0",
                use_find_package = true,
                required = false
            },
            opencv = {
                path = "third_party/opencv",
                include_dir = "include",
                lib_dir = "lib",
                use_find_package = true,
                components = {"core", "imgproc"}
            },
            spdlog = {
                path = "third_party/spdlog",
                include_dir = "include",
                lib_dir = "lib"
            }
        },
        
        -- 自动生成CMake配置
        auto_cmake = true
    },
    
    -- 文档配置
    documentation = {
        enabled = true,
        output_dir = "docs",
        default_template = "project_doc",
        auto_generate_api = false
    }
})
```

### 2. 项目目录结构

建议的项目目录结构：

```
MyQtProject/
├── CMakeLists.txt
├── src/
├── include/
├── ui/
├── docs/                   # 生成的文档目录
├── cmake/
│   └── ThirdParty.cmake    # 第三方库CMake配置
└── third_party/            # 第三方库目录
    ├── boost/
    │   ├── include/
    │   └── lib/
    ├── opencv/
    │   ├── include/
    │   └── lib/
    └── spdlog/
        ├── include/
        └── lib/
```

## 使用命令

### 文档生成命令

#### `:QtGenerateDoc [type] [output_file]`

生成不同类型的文档。

**支持的文档类型：**
- `project_doc` - 项目文档（默认）
- `api_doc` - API文档
- `module_doc` - 模块文档
- `third_party_lib_doc` - 第三方库集成文档

**示例：**

```vim
" 生成项目文档（保存到 docs/PROJECT.md）
:QtGenerateDoc

" 生成项目文档
:QtGenerateDoc project_doc

" 生成API文档
:QtGenerateDoc api_doc

" 生成第三方库集成文档
:QtGenerateDoc third_party_lib_doc

" 指定输出文件
:QtGenerateDoc project_doc docs/README.md
```

### 第三方库管理命令

#### `:QtAddThirdParty`

交互式添加第三方库配置。会询问：
- 库名称
- 库路径（相对于项目根目录）
- 包含目录（相对于库路径）
- 库目录（相对于库路径）

**示例使用流程：**

```vim
:QtAddThirdParty

" 然后按提示输入：
" Library name: boost
" Library path: third_party/boost
" Include directory: include
" Library directory: lib
```

这会在 CMakeLists.txt 中添加：

```cmake
# Third-party library: boost
set(BOOST_ROOT "${CMAKE_SOURCE_DIR}/third_party/boost")
include_directories("${BOOST_ROOT}/include")
link_directories("${BOOST_ROOT}/lib")
```

#### `:QtCreateThirdPartyCMake`

创建独立的第三方库CMake配置文件（`cmake/ThirdParty.cmake`）。

这个文件包含所有在配置中定义的第三方库的CMake设置。

**示例：**

```vim
:QtCreateThirdPartyCMake
```

生成的文件内容示例：

```cmake
# Third-party library configuration
# Auto-generated by Qt Assistant

# Set third-party library root directory
set(THIRD_PARTY_DIR "${CMAKE_SOURCE_DIR}/third_party")

# Configure boost
set(BOOST_ROOT "${CMAKE_SOURCE_DIR}/third_party/boost")
include_directories("${CMAKE_SOURCE_DIR}/third_party/boost/include")
link_directories("${CMAKE_SOURCE_DIR}/third_party/boost/lib")

# Configure opencv
set(OPENCV_ROOT "${CMAKE_SOURCE_DIR}/third_party/opencv")
include_directories("${CMAKE_SOURCE_DIR}/third_party/opencv/include")
link_directories("${CMAKE_SOURCE_DIR}/third_party/opencv/lib")

# Find third-party packages
find_package(boost 1.80.0)
find_package(opencv REQUIRED COMPONENTS core imgproc)
```

然后在主 CMakeLists.txt 中包含它：

```cmake
# 在 CMakeLists.txt 中添加
include(cmake/ThirdParty.cmake)
```

#### `:QtThirdPartyDoc`

生成第三方库集成文档，包含使用vcpkg、相对路径、子模块等多种集成方式的详细说明。

```vim
:QtThirdPartyDoc
```

## 配置选项详解

### third_party 配置

```lua
third_party = {
    -- 启用/禁用第三方库管理
    enabled = true,
    
    -- 第三方库根目录（相对于项目根目录）
    root_dir = "third_party",
    
    -- 库配置表
    libraries = {
        -- 库名称作为键
        library_name = {
            -- 库路径（可以是相对路径或绝对路径）
            path = "third_party/library_name",
            
            -- 包含目录（相对于库路径）
            include_dir = "include",
            
            -- 库文件目录（相对于库路径）
            lib_dir = "lib",
            
            -- 库版本（可选）
            version = "1.0.0",
            
            -- 是否使用 find_package（可选）
            use_find_package = true,
            
            -- 是否必需（用于 find_package REQUIRED）
            required = false,
            
            -- 组件列表（用于 find_package COMPONENTS）
            components = {"component1", "component2"}
        }
    },
    
    -- 自动生成CMake find_package调用
    auto_cmake = true
}
```

### documentation 配置

```lua
documentation = {
    -- 启用/禁用文档生成
    enabled = true,
    
    -- 文档输出目录
    output_dir = "docs",
    
    -- 默认文档模板类型
    default_template = "project_doc",
    
    -- 自动生成API文档
    auto_generate_api = false
}
```

## 实际使用示例

### 示例1：添加Boost库

```lua
-- 在配置中添加
require('qt-assistant').setup({
    third_party = {
        enabled = true,
        libraries = {
            boost = {
                path = "third_party/boost_1_80_0",
                include_dir = "include",
                lib_dir = "lib",
                version = "1.80.0",
                use_find_package = true,
                components = {"filesystem", "system"}
            }
        }
    }
})
```

或使用命令：

```vim
:QtAddThirdParty
" 输入：boost
" 路径：third_party/boost_1_80_0
" 包含：include
" 库：lib
```

### 示例2：添加OpenCV库

```lua
opencv = {
    path = "third_party/opencv",
    include_dir = "include",
    lib_dir = "x64/vc16/lib",  -- Windows MSVC路径
    use_find_package = true,
    required = true,
    components = {"core", "imgproc", "highgui"}
}
```

### 示例3：添加header-only库（如nlohmann/json）

```lua
nlohmann_json = {
    path = "third_party/json",
    include_dir = "include",
    -- header-only库不需要lib_dir
    use_find_package = false
}
```

### 示例4：完整项目配置

```lua
require('qt-assistant').setup({
    project_root = vim.fn.getcwd(),
    
    third_party = {
        enabled = true,
        root_dir = "third_party",
        libraries = {
            boost = {
                path = "third_party/boost",
                include_dir = "include",
                lib_dir = "lib",
                use_find_package = true,
                components = {"filesystem", "system", "thread"}
            },
            opencv = {
                path = "third_party/opencv",
                include_dir = "include",
                lib_dir = "lib",
                use_find_package = true,
                required = true,
                components = {"core", "imgproc"}
            },
            spdlog = {
                path = "third_party/spdlog",
                include_dir = "include",
                lib_dir = "lib"
            }
        },
        auto_cmake = true
    },
    
    documentation = {
        enabled = true,
        output_dir = "docs"
    },
    
    vcpkg = {
        enabled = true,
        vcpkg_root = "C:/vcpkg"
    }
})
```

## 工作流程

### 添加新的第三方库

1. **下载/编译第三方库**
   ```bash
   cd third_party
   # 下载或编译你的库
   ```

2. **使用命令添加库配置**
   ```vim
   :QtAddThirdParty
   ```

3. **或者创建集中的CMake配置文件**
   ```vim
   :QtCreateThirdPartyCMake
   ```

4. **在CMakeLists.txt中使用**
   ```cmake
   # 如果使用集中配置
   include(cmake/ThirdParty.cmake)
   
   # 链接库
   target_link_libraries(your_app PRIVATE
       boost_filesystem
       boost_system
       opencv_core
   )
   ```

### 生成项目文档

1. **生成项目主文档**
   ```vim
   :QtGenerateDoc project_doc
   ```

2. **生成第三方库集成说明**
   ```vim
   :QtThirdPartyDoc
   ```

3. **为特定模块生成文档**
   ```vim
   :QtGenerateDoc module_doc docs/MODULE_NAME.md
   ```

## 最佳实践

1. **使用相对路径** - 便于项目在不同机器上移植
2. **版本锁定** - 在配置中指定库版本
3. **文档同步** - 添加库后立即生成文档
4. **使用vcpkg** - 对于常用库，优先使用vcpkg管理
5. **目录结构** - 保持清晰的third_party目录结构

## 故障排查

### 问题：找不到第三方库

**解决方法：**
1. 检查库路径是否正确
2. 确认include_dir和lib_dir设置正确
3. 使用`:QtDoctor`查看配置

### 问题：CMake找不到库

**解决方法：**
1. 检查CMAKE_PREFIX_PATH设置
2. 确认use_find_package配置正确
3. 查看生成的cmake/ThirdParty.cmake文件

### 问题：链接错误

**解决方法：**
1. 确认库文件存在于指定的lib_dir
2. 检查debug/release配置匹配
3. Windows下确认使用正确的编译器版本

## 参考资源

- [Qt Assistant 主文档](README.md)
- [CMake文档](https://cmake.org/documentation/)
- [vcpkg文档](https://vcpkg.io/)

## 更新日志

- **v1.0** - 初始版本，添加第三方库管理和文档生成功能
